# Render Blueprint for Celestia Arcana
# This file configures automatic deployment to Render with full Python + Node support

services:
  - type: web
    name: celestia-arcana
    runtime: node
    plan: starter  # Free tier available
    region: oregon  # Change to your preferred region

    # Build Configuration
    buildCommand: |
      # Install Bun for faster JS builds
      curl -fsSL https://bun.sh/install | bash
      export BUN_INSTALL="$HOME/.bun"
      export PATH="$BUN_INSTALL/bin:$PATH"
      # Install JS dependencies with Bun
      bun install --frozen-lockfile
      # Optional: install Python deps if scripts rely on them
      if [ -f requirements.txt ]; then
        python3 -m pip install --upgrade pip
        python3 -m pip install --target ./python_packages -r requirements.txt
      fi
      # Build SvelteKit application
      bun run build

    # Start Command
    startCommand: node build/index.js

    # Environment Variables
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: PYTHON_VERSION
        value: 3.11
      - key: PORT
        value: 10000  # Render default port
      - key: HOST
        value: 0.0.0.0
      - key: OPENAI_API_KEY
        sync: false  # Set manually in Render dashboard
      - key: ASTRO_TAROT_MODEL
        value: gpt-4o-mini
      - key: ENABLE_RESPONSE_CACHE
        value: true
      - key: PYTHONPATH
        value: /app/python_packages

    # Auto-deploy on Git push
    autoDeploy: true

    # Health check
    healthCheckPath: /

    # Disk storage (optional, for caching)
    disk:
      name: celestia-data
      mountPath: /app/data
      sizeGB: 1
